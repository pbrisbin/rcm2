#!/bin/sh
. "$(dirname "$0")"/../share/rcm/rcm.sh

usage() {
  printf "Usage: rcup [-CVqvfhikK] [-I EXCL_PAT] [-x EXCL_PAT] [-t TAG] [-d DOT_DIR]\n"
  printf "see rcup(1) and rcm(5) for more details\n"
}

process_dotfile() {
  local dotfile="$1"
  local destination="$(destination "$dotfile")"
  local directory="$(dirname "$destination")"

  if [ -e "$destination" ]; then
    if same_file "$dotfile" "$destination"; then
      debug "skipping $dotfile (exists and contents match)"
      return 0
    else
      # TODO: force/prompt
      debug "$dotfile exists and is different"
      return 1
    fi
  fi

  install_dotfile "$dotfile" "$destination"
}

parse_options "$@" && process_dotfiles
