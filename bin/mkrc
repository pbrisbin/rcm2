#!/bin/sh
: ${RCM_LIB:=$(dirname "$0")/../share/rcm}
. "$RCM_LIB"/rcm.sh

usage() {
  printf "Usage: mkrc [-hvqo] [-t TAG] [-d DIR] FILES ...\n"
  printf "see mkrc(1) and rcm(5) for more details\n"
}

set_dotfiles_dir() {
  for dotfiles_dir in $dotfiles_dirs; do :; done
  for tag in $tags; do :; done

  if [ -n "$tag" ]; then
    debug "installing tag-specifically"
    dotfiles_dir="$dotfiles_dir/tag-$tag"
  elif [ "$host_specific" -eq 1 ]; then
    debug "installing host-specifically"
    dotfiles_dir="$dotfiles_dir/host-${HOST:-$(hostname)}"
  fi
}

add_dotfile() {
  local file="$1"

  debug "adding $file to $dotfiles_dir"

  dotfile="$dotfiles_dir/$(printf "$file" | sed "s|^$HOME/\.||")"
  directory="$(dirname "$dotfile")"

  [ ! -d "$directory" ] && _mkdir -p "$directory"

  _mv "$file" "$dotfile"

  install_dotfile "$dotfile" "$file"
}

if parse_options "$@"; then
  set_dotfiles_dir

  for file in $files; do
    add_dotfile "$file"
  done
fi
